<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Thales PR</title>

    <!-- Bootstrap core CSS -->
    <link href="./bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="./bootstrap-3.3.6-dist/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h1 class="masthead-brand">Scores</h1>
              <nav>
                <ul class="nav masthead-nav">
                  <li class="active"><a href="etape1.html">Accueil</a></li>
                  <li><a href="score.html">Scores</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">
            <h3 class="cover-heading">Votre score</h3>
            <p class="lead" id="score"></p>
            <!--<a href="#" onclick="clearScore()" class="btn btn-lg btn-default">Réinitialiser</a>-->
            
            <table class="table table-striped">
			  <thead>
			      <tr>
			        <th>Pseudo</th>
			        <th>Score Tactile</th>
			        <th>Score Leap</th>
			      </tr>
			    </thead>
			    <tbody id="score_table">
			      
			    </tbody>
			</table>
          </div>

          <div class="mastfoot">
            <div class="inner">
              <p>Application réalisée par <a href="#">Amélie Perdriaud</a> et <a href="#">Nicolas Lhomme</a>.</p>
            </div>
          </div>

        </div>

      </div>

    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="./bootstrap-3.3.6-dist/js/jquery.min.js"><\/script>')</script>
    <script src="./bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./bootstrap-3.3.6-dist/js/ie10-viewport-bug-workaround.js"></script>
    <script src='js/sql.js-master/js/sql.js'></script>
    <script type="text/javascript">
		  	var parameters = location.search.substring(1).split("&");
		    var temp = parameters[0].split("=");
		    var pseudo = unescape(temp[1]);
		    temp = parameters[1].split("=");
			var score_tactile = unescape(temp[1]);
		    temp = parameters[2].split("=");
			var compteur_tactile = unescape(temp[1]);
		    temp = parameters[3].split("=");
			var score_leap = unescape(temp[1]);
		    temp = parameters[4].split("=");
			var compteur_leap = unescape(temp[1]);
			showScore();
		  
		  function showScore() {
		    document.getElementById("score").innerHTML = pseudo + ", votre score est de " + score_tactile + " sur "+compteur_tactile+" avec les boutons, et de "+score_leap+" sur "+compteur_leap+" avec les post-it." ;
		  	loadScore ();
		  }
		
		  function loadScore () {
			var SQL = window.SQL;
			var xhr = new XMLHttpRequest();
			xhr.open('GET', './db', true);
			xhr.responseType = 'arraybuffer';
			xhr.onload = function(e) {
				var uInt8Array = new Uint8Array(this.response);
				var db = new SQL.Database(uInt8Array);
				db.run("INSERT INTO score VALUES (?,?,?)", [pseudo,score_tactile,score_leap]);
				var contents = db.exec("SELECT * FROM score");
				var table = "";
				for (var j=0; j<contents.length; j++) {
				table.concat('<tr><td>'+contents[j][0]+'</td><td>'+contents[j][1]+'</td><td>'+contents[j][2]+'</td></tr>');
				}
				document.getElementById("score_table").innerHTML = table;
			};
			xhr.send();
			}

		</script>
  </body>
</html>
